# Концепция функции "Групповые задачи"

## 📋 Общее описание

"Групповые задачи" - это функционал совместной работы над задачами между студентами. Позволяет создавать задачи, приглашать других участников, отслеживать прогресс команды и работать вместе над общими целями.

---

## 🎯 Основной функционал

### 1. Создание групповой задачи
- Любой пользователь может создать групповую задачу
- При создании автоматически становится "владельцем" задачи
- Можно сразу пригласить участников или сделать это позже
- Владелец может удалить задачу или изменить её статус

### 2. Приглашение участников
**Способы приглашения:**
- **По Telegram ID** - ввести ID пользователя вручную
- **По username** - @username в Telegram
- **Через ссылку** - сгенерировать уникальную ссылку для приглашения
- **Из вашей группы** - выбрать студентов из той же учебной группы в RUDN

**Лимиты:**
- Максимум 10 участников в одной групповой задаче
- Минимум 2 участника (создатель + 1 приглашённый)

### 3. Роли участников

**Владелец (Owner):**
- Создал задачу
- Может приглашать/удалять участников
- Может удалить задачу полностью
- Может редактировать все параметры задачи
- Может передать права владельца другому участнику

**Участник (Member):**
- Может отмечать задачу выполненной/невыполненной
- Может писать комментарии
- Может покинуть задачу
- Может видеть всех участников и прогресс

### 4. Статусы задачи

**Для групповой задачи:**
- **Создана** - задача создана, ожидает участников
- **В работе** - есть участники, задача в процессе
- **Завершена** - все участники отметили выполнение
- **Просрочена** - дедлайн истёк, задача не завершена

**Прогресс выполнения:**
- Подсчитывается как: (количество участников, отметивших выполнение) / (общее количество участников)
- Пример: 3/5 участников выполнили задачу = 60% прогресс
- Задача считается завершённой, когда ВСЕ участники отметили выполнение

### 5. Система уведомлений

**Уведомления отправляются когда:**
- Вас пригласили в групповую задачу
- Участник присоединился к задаче
- Участник покинул задачу
- Участник отметил задачу выполненной
- Задача завершена (100% участников)
- Приближается дедлайн (за 24 часа)
- Задача просрочена
- Добавлен комментарий

**Настройки уведомлений:**
- Можно отключить уведомления для конкретной групповой задачи
- Можно отключить все уведомления о групповых задачах

---

## 🎨 Визуальный дизайн

### 1. Иконка и цветовая схема

**Основной цвет:** Синий градиент (от #4F46E5 до #7C3AED)
- Символизирует командную работу и сотрудничество
- Отличается от личных задач (желто-оранжевый градиент)

**Иконка:** Users (две фигуры людей) из lucide-react

### 2. Карточка групповой задачи в списке

```
┌─────────────────────────────────────────────────────────┐
│ [Users 👥]  Подготовка к экзамену по математике         │
│                                                          │
│ 👤 3/5 участников выполнили                             │
│ ━━━━━━━━━━░░░░░░░░░░ 60%                               │
│                                                          │
│ 📅 Дедлайн: 15 декабря, 23:59                           │
│                                                          │
│ [Аватары участников: 5 кружков]                          │
│  ✓ Иван   ✓ Мария   ✓ Алекс   ⏳ Света   ⏳ Дима       │
│                                                          │
│ 💬 3 комментария    👤 Владелец: Иван                   │
└─────────────────────────────────────────────────────────┘
```

**Элементы карточки:**
1. **Иконка + Название** - синяя иконка Users + текст задачи
2. **Прогресс-бар** - визуализация выполнения (X/Y участников)
3. **Дедлайн** - если установлен, с иконкой календаря
4. **Аватары участников** - кружки с первыми буквами имён или фото
   - Зелёная галочка ✓ - выполнил задачу
   - Песочные часы ⏳ - ещё не выполнил
5. **Счётчик комментариев** - количество сообщений
6. **Владелец** - кто создал задачу

**Визуальные отличия от личных задач:**
- Градиентная рамка синего цвета (вместо желтого)
- Иконка Users (вместо Clipboard)
- Показывается прогресс-бар выполнения
- Отображаются аватары участников

### 3. Детальный экран групповой задачи

**Модальное окно открывается при клике на карточку:**

```
┌─────────────────────────────────────────────────────────┐
│  [X]                                          [...меню]  │
│                                                          │
│  👥 Подготовка к экзамену по математике                  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━│
│                                                          │
│  📊 Прогресс выполнения                                  │
│  ━━━━━━━━━━━━░░░░░░░░░░░ 60% (3/5)                      │
│                                                          │
│  👥 Участники (5)                                        │
│  ┌──────────────────────────────────────┐               │
│  │ ✅ Иван Петров (владелец)    👤      │               │
│  │ ✅ Мария Смирнова            👤      │               │
│  │ ✅ Алекс Козлов              👤      │               │
│  │ ⏳ Света Иванова             👤      │               │
│  │ ⏳ Дима Сидоров              👤      │               │
│  └──────────────────────────────────────┘               │
│                                                          │
│  📅 Дедлайн: 15 декабря 2025, 23:59                     │
│  🏷️ Категория: Учёба                                    │
│  ⚡ Приоритет: Высокий                                   │
│                                                          │
│  💬 Комментарии (3)                                      │
│  ┌──────────────────────────────────────┐               │
│  │ Иван: Давайте разделим темы?          │               │
│  │ 10:30                                 │               │
│  ├──────────────────────────────────────┤               │
│  │ Мария: Я беру главы 1-3               │               │
│  │ 11:45                                 │               │
│  ├──────────────────────────────────────┤               │
│  │ Алекс: Главы 4-6 за мной              │               │
│  │ 12:20                                 │               │
│  └──────────────────────────────────────┘               │
│                                                          │
│  [Написать комментарий...]                  [Отправить] │
│                                                          │
│  [Отметить выполненной]  или  [Покинуть группу]         │
└─────────────────────────────────────────────────────────┘
```

**Элементы детального экрана:**
1. **Заголовок** - название задачи с иконкой
2. **Прогресс-бар** - процент выполнения
3. **Список участников** - с аватарами и статусами
   - Зелёная галочка ✅ - выполнил
   - Песочные часы ⏳ - не выполнил
   - Метка "владелец" для создателя
4. **Информация о задаче** - дедлайн, категория, приоритет
5. **Секция комментариев** - лента сообщений
6. **Поле ввода комментария** - для быстрой коммуникации
7. **Действия** - отметить выполненной, покинуть группу

### 4. Модальное окно создания групповой задачи

```
┌─────────────────────────────────────────────────────────┐
│  Создать групповую задачу                         [X]   │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━│
│                                                          │
│  Название задачи *                                       │
│  [________________________________]                      │
│                                                          │
│  Описание (необязательно)                                │
│  [________________________________]                      │
│  [________________________________]                      │
│                                                          │
│  Дедлайн                                                 │
│  [15 декабря 2025 ▼]  [23:59 ▼]                        │
│                                                          │
│  Категория                                               │
│  [🎓 Учёба ▼]                                           │
│                                                          │
│  Приоритет                                               │
│  ⚡ Высокий  ◯ Средний  ◯ Низкий                        │
│                                                          │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━│
│                                                          │
│  Пригласить участников                                   │
│                                                          │
│  [Telegram ID или @username]            [+ Добавить]    │
│                                                          │
│  Приглашённые участники (2):                             │
│  ┌──────────────────────────────────────┐               │
│  │ 👤 @maria_smirnova           [x]      │               │
│  │ 👤 @alex_kozlov              [x]      │               │
│  └──────────────────────────────────────┘               │
│                                                          │
│  [📋 Скопировать ссылку приглашения]                     │
│                                                          │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━│
│                                                          │
│  [Отмена]                          [Создать задачу]     │
└─────────────────────────────────────────────────────────┘
```

### 5. Визуальные индикаторы

**Статусы участников:**
- ✅ Зелёная галочка - выполнил задачу
- ⏳ Песочные часы - ещё не выполнил
- 👑 Корона - владелец задачи
- 🚫 Серый цвет - покинул задачу

**Цвета прогресс-бара:**
- 0-30% - Красный градиент (мало прогресса)
- 31-70% - Жёлтый градиент (средний прогресс)
- 71-99% - Синий градиент (почти готово)
- 100% - Зелёный градиент (завершено) ✨

**Бейджи:**
- "НОВАЯ" - задача создана менее 24 часов назад
- "СРОЧНО" - до дедлайна осталось менее 24 часов
- "ПРОСРОЧЕНО" - дедлайн прошёл
- "ЗАВЕРШЕНО" - 100% выполнение

---

## 🔧 Технические детали

### Backend API endpoints

```python
# Создание групповой задачи
POST /api/group-tasks
Body: {
  "title": str,
  "description": str,
  "deadline": datetime,
  "category": str,
  "priority": str,
  "telegram_id": int,  # создатель
  "invited_users": [telegram_id, ...]  # список приглашённых
}

# Получение всех групповых задач пользователя
GET /api/group-tasks/{telegram_id}

# Получение детальной информации о задаче
GET /api/group-tasks/detail/{task_id}

# Приглашение участника
POST /api/group-tasks/{task_id}/invite
Body: {
  "telegram_id": int,  # кто приглашает
  "invited_user": int or str  # ID или @username
}

# Принятие приглашения
POST /api/group-tasks/{task_id}/accept
Body: {
  "telegram_id": int
}

# Отклонение приглашения
POST /api/group-tasks/{task_id}/decline
Body: {
  "telegram_id": int
}

# Отметить задачу выполненной
PUT /api/group-tasks/{task_id}/complete
Body: {
  "telegram_id": int,
  "completed": bool
}

# Покинуть задачу
DELETE /api/group-tasks/{task_id}/leave
Body: {
  "telegram_id": int
}

# Удалить задачу (только владелец)
DELETE /api/group-tasks/{task_id}
Body: {
  "telegram_id": int  # должен быть владелец
}

# Добавить комментарий
POST /api/group-tasks/{task_id}/comments
Body: {
  "telegram_id": int,
  "text": str
}

# Получить комментарии
GET /api/group-tasks/{task_id}/comments

# Генерация ссылки приглашения
POST /api/group-tasks/{task_id}/invite-link
Body: {
  "telegram_id": int
}
Response: {
  "invite_link": "https://t.me/rudn_pro_bot?start=join_task_abc123xyz"
}
```

### MongoDB схемы

```python
# GroupTask
{
  "task_id": str (UUID),
  "title": str,
  "description": str,
  "deadline": datetime,
  "category": str,
  "priority": str,
  "owner_id": int,  # telegram_id владельца
  "created_at": datetime,
  "updated_at": datetime,
  "status": str,  # created, in_progress, completed, overdue
  "participants": [
    {
      "telegram_id": int,
      "username": str,
      "first_name": str,
      "joined_at": datetime,
      "completed": bool,
      "completed_at": datetime,
      "role": str  # owner, member
    }
  ],
  "invite_token": str,  # для ссылки приглашения
  "notification_settings": {
    "enabled": bool,
    "notify_on_join": bool,
    "notify_on_complete": bool,
    "notify_on_comment": bool
  }
}

# GroupTaskComment
{
  "comment_id": str (UUID),
  "task_id": str,
  "telegram_id": int,
  "username": str,
  "text": str,
  "created_at": datetime,
  "edited": bool,
  "edited_at": datetime
}

# GroupTaskInvite
{
  "invite_id": str (UUID),
  "task_id": str,
  "invited_by": int,
  "invited_user": int,
  "status": str,  # pending, accepted, declined
  "created_at": datetime,
  "responded_at": datetime
}
```

---

## 🎮 Пользовательские сценарии

### Сценарий 1: Создание групповой задачи

1. Пользователь открывает раздел "Список дел"
2. Нажимает кнопку "+" для создания задачи
3. В модальном окне выбирает переключатель "Групповая задача"
4. Заполняет название: "Подготовка к экзамену по математике"
5. Устанавливает дедлайн: 15 декабря
6. Приоритет: Высокий
7. Добавляет участников: @maria_smirnova, @alex_kozlov
8. Нажимает "Создать задачу"
9. Задача появляется в списке с синим градиентом
10. Участники получают уведомление о приглашении

### Сценарий 2: Присоединение к задаче

1. Мария получает уведомление: "Иван пригласил вас в групповую задачу"
2. Открывает уведомление
3. Видит детали задачи и кнопки "Принять" / "Отклонить"
4. Нажимает "Принять"
5. Задача появляется в её списке задач
6. Иван получает уведомление: "Мария присоединилась к задаче"

### Сценарий 3: Работа над задачей

1. Мария открывает групповую задачу
2. Видит список участников: Иван ✅, Алекс ✅, Света ⏳, Дима ⏳, Мария ⏳
3. Пишет комментарий: "Я беру главы 1-3"
4. Все участники получают уведомление о комментарии
5. После изучения материала Мария нажимает "Отметить выполненной"
6. Прогресс-бар обновляется: 3/5 (60%)
7. Все участники видят обновлённый статус

### Сценарий 4: Завершение задачи

1. Дима - последний участник, отмечает задачу выполненной
2. Прогресс становится 100% (5/5)
3. Статус задачи меняется на "Завершено"
4. Все участники получают уведомление: "Задача завершена! 🎉"
5. Задача перемещается в раздел "Завершённые"
6. Владелец Иван может удалить задачу или оставить в истории

---

## 📱 Адаптация для мобильных

### Компактный режим (< 640px)

**Карточка групповой задачи:**
- Высота: auto (адаптивная)
- Padding: 12px
- Аватары участников: 32px × 32px (максимум 5 видимых, остальные "+N")
- Прогресс-бар: высота 6px
- Шрифты: title 14px, описание 12px

**Модальное окно:**
- Открывается снизу (slide up animation)
- Высота: 90vh
- Swipe down для закрытия
- Фиксированный header и footer
- Прокручиваемый контент

**Список участников:**
- Вертикальный список
- Каждый участник: 48px высота
- Имя + статус + аватар

---

## 🎨 Анимации

### Прогресс-бар
- Плавное заполнение при изменении (ease-out, 0.5s)
- Pulse эффект при достижении 100%
- Конфетти 🎊 при завершении задачи всеми участниками

### Уведомления
- Slide-in справа с bounce эффектом
- Авто-закрытие через 5 секунд
- Haptic feedback при получении

### Комментарии
- Новый комментарий появляется с fade-in + slide-up
- Highlight эффект (жёлтый фон на 2 секунды) для нового комментария

### Аватары участников
- Пульсация для участников online
- Зелёная галочка появляется с scale + rotate анимацией

---

## 🔐 Приватность и безопасность

### Приватность
- Групповые задачи видны только участникам
- Нельзя пригласить пользователя без его согласия (должен принять приглашение)
- Комментарии видны только участникам задачи

### Модерация
- Владелец может удалить участника из задачи
- Участник может пожаловаться на неподобающие комментарии
- Автоматическое удаление задачи через 30 дней после завершения

### Лимиты
- Максимум 10 участников в задаче
- Максимум 50 групповых задач на пользователя одновременно
- Максимум 100 комментариев на задачу
- Максимум 10 приглашений в день

---

## 💡 Дополнительные идеи (для будущих версий)

### V2.0 - Расширенный функционал
1. **Подзадачи** - разбить большую задачу на мини-задачи
2. **Назначение ответственных** - назначить конкретную подзадачу участнику
3. **Файлы** - прикреплять документы к задаче
4. **Голосование** - проголосовать за решение в задаче
5. **Теги** - добавить теги для поиска (#экзамен, #срочно)

### V3.0 - Интеграция
1. **Экспорт в календарь** - добавить задачу в Google Calendar
2. **Telegram чат** - создать групповой чат для обсуждения
3. **Статистика команды** - кто самый активный участник
4. **Шаблоны задач** - сохранить задачу как шаблон для повторного использования

---

## 📊 Метрики успеха

**KPI для функции:**
- Количество созданных групповых задач в день
- Средний размер группы (количество участников)
- Процент завершённых групповых задач
- Среднее время до завершения задачи
- Количество комментариев на задачу
- Процент принятых приглашений

**Цели:**
- 20% пользователей создают минимум 1 групповую задачу в месяц
- 70% приглашений принимаются
- 60% групповых задач завершаются до дедлайна
- Средний размер группы: 3-4 участника

---

## ✅ MVP - Минимальный функционал для запуска

**Обязательно для MVP:**
1. ✅ Создание групповой задачи
2. ✅ Приглашение участников по @username
3. ✅ Просмотр списка групповых задач
4. ✅ Отметка задачи выполненной
5. ✅ Прогресс-бар выполнения
6. ✅ Базовые комментарии
7. ✅ Уведомления (приглашение, завершение)
8. ✅ Покинуть задачу

**Можно отложить:**
- ❌ Ссылка приглашения
- ❌ Передача прав владельца
- ❌ Удаление участников владельцем
- ❌ Редактирование комментариев
- ❌ Приглашение из учебной группы
- ❌ Расширенные настройки уведомлений

---

## 🎯 Итоговая концепция

**Групповые задачи** - это простой и эффективный инструмент совместной работы студентов над общими целями:

- 🎨 **Визуально отличимы** - синий градиент, иконка Users
- 👥 **Совместная работа** - до 10 участников
- 📊 **Прозрачный прогресс** - видно кто выполнил, кто нет
- 💬 **Коммуникация** - комментарии для обсуждения
- 🔔 **Уведомления** - все в курсе прогресса
- 🎉 **Геймификация** - конфетти при завершении всеми участниками

**Ключевое отличие от личных задач:**
- Личная задача = индивидуальная ответственность
- Групповая задача = командная ответственность и прозрачность прогресса
